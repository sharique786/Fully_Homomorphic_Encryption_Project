<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enterprise-Scale FHE Architecture for Financial Transactions</title>
    <style>
        @media print {
            .slide {
                page-break-after: always;
                page-break-inside: avoid;
            }
            button {
                display: none;
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .slide {
            background: white;
            border-radius: 20px;
            padding: 50px;
            margin-bottom: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            min-height: 800px;
        }

        .title-slide {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .title-slide h1 {
            font-size: 3.5em;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .title-slide .subtitle {
            font-size: 1.5em;
            margin-bottom: 20px;
            opacity: 0.9;
        }

        .title-slide .meta {
            margin-top: 50px;
            font-size: 1.1em;
            opacity: 0.8;
        }

        h2 {
            color: #1e3c72;
            font-size: 2.5em;
            margin-bottom: 30px;
            border-bottom: 4px solid #667eea;
            padding-bottom: 15px;
        }

        h3 {
            color: #2a5298;
            font-size: 1.8em;
            margin-top: 30px;
            margin-bottom: 20px;
        }

        .architecture-diagram {
            background: #f8f9fa;
            border: 3px solid #667eea;
            border-radius: 15px;
            padding: 40px;
            margin: 30px 0;
            position: relative;
        }

        .component-box {
            background: white;
            border: 3px solid #333;
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            position: relative;
        }

        .client-zone {
            border-color: #dc3545;
            background: linear-gradient(135deg, #fff5f5 0%, #ffe5e5 100%);
        }

        .server-zone {
            border-color: #28a745;
            background: linear-gradient(135deg, #f0fff4 0%, #dcffe4 100%);
        }

        .cloud-zone {
            border-color: #007bff;
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
        }

        .storage-zone {
            border-color: #fd7e14;
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
        }

        .zone-label {
            position: absolute;
            top: -15px;
            left: 20px;
            background: white;
            padding: 5px 20px;
            font-weight: bold;
            font-size: 0.9em;
            border-radius: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .client-zone .zone-label {
            background: #dc3545;
            color: white;
        }

        .server-zone .zone-label {
            background: #28a745;
            color: white;
        }

        .cloud-zone .zone-label {
            background: #007bff;
            color: white;
        }

        .storage-zone .zone-label {
            background: #fd7e14;
            color: white;
        }

        .flow-arrow {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
            color: #667eea;
            font-size: 2em;
            font-weight: bold;
        }

        .data-flow {
            background: #e3f2fd;
            border-left: 5px solid #2196F3;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }

        .highlight-box {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .stat-card .number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-card .label {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .key-points {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
        }

        .key-points ul {
            list-style: none;
            padding: 0;
        }

        .key-points li {
            padding: 15px;
            margin: 10px 0;
            background: white;
            border-left: 5px solid #667eea;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .key-points li::before {
            content: "‚úì ";
            color: #28a745;
            font-weight: bold;
            font-size: 1.3em;
            margin-right: 10px;
        }

        .tech-stack {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 20px 0;
        }

        .tech-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: bold;
        }

        table td {
            padding: 15px;
            border-bottom: 1px solid #ddd;
        }

        table tr:nth-child(even) {
            background: #f8f9fa;
        }

        table tr:hover {
            background: #e9ecef;
        }

        .security-layer {
            background: #fff;
            border: 2px solid #dc3545;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            position: relative;
            padding-left: 60px;
        }

        .security-layer::before {
            content: "üîí";
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 2em;
        }

        .timeline {
            position: relative;
            padding: 20px 0;
            margin: 30px 0;
        }

        .timeline-item {
            background: white;
            border-left: 5px solid #667eea;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            position: relative;
            padding-left: 80px;
        }

        .timeline-item::before {
            content: attr(data-phase);
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: #667eea;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
        }

        .code-snippet {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 10px;
            overflow-x: auto;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            line-height: 1.6;
        }

        .code-snippet .comment {
            color: #6a9955;
        }

        .code-snippet .keyword {
            color: #569cd6;
        }

        .code-snippet .string {
            color: #ce9178;
        }

        .navigation {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 30px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
            transition: transform 0.3s, box-shadow 0.3s;
            margin: 5px;
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(102, 126, 234, 0.6);
        }

        .compliance-badge {
            display: inline-block;
            background: #28a745;
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            margin: 5px;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }

        .warning-box {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            display: flex;
            align-items: center;
        }

        .warning-box::before {
            content: "‚ö†Ô∏è";
            font-size: 2em;
            margin-right: 20px;
        }

        .success-box {
            background: #d4edda;
            border: 2px solid #28a745;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            display: flex;
            align-items: center;
        }

        .success-box::before {
            content: "‚úÖ";
            font-size: 2em;
            margin-right: 20px;
        }

        .flow-diagram {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .flow-step {
            background: white;
            border: 3px solid #667eea;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            min-width: 200px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            position: relative;
        }

        .flow-step .step-number {
            background: #667eea;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin: 0 auto 15px;
        }

        .arrow-right::after {
            content: "‚Üí";
            font-size: 2em;
            color: #667eea;
            margin: 0 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Slide 1: Title -->
        <div class="slide title-slide">
            <h1>üîí Enterprise-Scale FHE Architecture</h1>
            <div class="subtitle">Fully Homomorphic Encryption for Financial Transaction Analysis</div>
            <div class="subtitle">Processing Millions of Daily Transactions Securely</div>
            <div class="tech-stack" style="justify-content: center; margin-top: 40px;">
                <div class="tech-badge">TenSEAL</div>
                <div class="tech-badge">OpenFHE</div>
                <div class="tech-badge">GCP Cloud</div>
                <div class="tech-badge">Apache Spark</div>
                <div class="tech-badge">BigQuery</div>
            </div>
            <div class="meta">
                <p><strong>Version:</strong> 1.0 | <strong>Classification:</strong> Confidential</p>
                <p><strong>Date:</strong> November 2024</p>
            </div>
        </div>

        <!-- Slide 2: Architecture Overview -->
        <div class="slide">
            <h2>üìê Architecture Overview</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="number">Millions</div>
                    <div class="label">Daily Transactions</div>
                </div>
                <div class="stat-card">
                    <div class="number">7 Days</div>
                    <div class="label">GCP Hot Storage</div>
                </div>
                <div class="stat-card">
                    <div class="number">< 30 sec</div>
                    <div class="label">Query Response Time</div>
                </div>
                <div class="stat-card">
                    <div class="number">100%</div>
                    <div class="label">Data Encrypted</div>
                </div>
            </div>

            <div class="highlight-box">
                <h3>Core Principles</h3>
                <div class="key-points">
                    <ul>
                        <li><strong>Zero-Knowledge Server:</strong> Server performs computations without seeing plaintext data</li>
                        <li><strong>Client-Side Keys:</strong> Private keys never leave client environment</li>
                        <li><strong>Scalable Processing:</strong> Distributed encryption via Apache Spark on Dataproc</li>
                        <li><strong>Data Residency:</strong> Automatic migration to regional lakes after 7 days</li>
                        <li><strong>Enterprise Security:</strong> Bank-wide KMS with HSM protection</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Slide 3: System Boundaries -->
        <div class="slide">
            <h2>üîê System Boundaries & Security Zones</h2>

            <div class="architecture-diagram">
                <div class="component-box client-zone">
                    <div class="zone-label">CLIENT ZONE (Trusted)</div>
                    <h3>üñ•Ô∏è FHE Client Application</h3>
                    <div class="key-points">
                        <ul>
                            <li>Holds Private Key (pk) - <strong>NEVER leaves client</strong></li>
                            <li>Performs client-side decryption only</li>
                            <li>Transaction selection & query building</li>
                            <li>Secure connection to Bank KMS</li>
                            <li>Interactive UI for analysis requests</li>
                        </ul>
                    </div>
                    <div class="warning-box">
                        <strong>Security Boundary:</strong> Private keys are stored in-memory only, never persisted or transmitted
                    </div>
                </div>

                <div class="flow-arrow">‚¨áÔ∏è Public Key, Evaluation Keys ‚¨áÔ∏è</div>

                <div class="component-box server-zone">
                    <div class="zone-label">SERVER ZONE (Untrusted - Zero Knowledge)</div>
                    <h3>‚òÅÔ∏è FHE Compute Service</h3>
                    <div class="key-points">
                        <ul>
                            <li>Receives Public Key (pk) + Evaluation Keys only</li>
                            <li>Stores encrypted data (ciphertext C)</li>
                            <li>Performs homomorphic operations on C</li>
                            <li>Returns encrypted results C'</li>
                            <li><strong>CANNOT decrypt - no private key</strong></li>
                        </ul>
                    </div>
                    <div class="success-box">
                        <strong>Zero-Knowledge Guarantee:</strong> Server never sees plaintext data at any point
                    </div>
                </div>

                <div class="flow-arrow">‚¨ÜÔ∏è Encrypted Results C' ‚¨ÜÔ∏è</div>
            </div>

            <div class="highlight-box">
                <h3>üîë Key Distribution Model</h3>
                <p><strong>Client possesses:</strong> Private Key (sk), Public Key (pk), Relinearization Keys, Galois Keys</p>
                <p><strong>Server receives:</strong> Public Key (pk), Evaluation Keys (relin, galois) - for FHE operations only</p>
                <p><strong>Result:</strong> Client decrypts with sk ‚Üí Plaintext P</p>
            </div>
        </div>

        <!-- Slide 4: Key Management Architecture -->
        <div class="slide">
            <h2>üîë Enterprise Key Management System</h2>

            <div class="architecture-diagram">
                <div class="component-box" style="background: linear-gradient(135deg, #fff9e6 0%, #ffecb3 100%); border-color: #ff9800;">
                    <div class="zone-label" style="background: #ff9800; color: white;">BANK-WIDE KMS</div>
                    <h3>üè¶ Centralized Key Management Store</h3>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                        <div class="security-layer">
                            <h4>Key Generation Service</h4>
                            <ul>
                                <li>HSM-based generation</li>
                                <li>CKKS/BFV context creation</li>
                                <li>Scheduled rotation (30-90 days)</li>
                                <li>Multi-region support</li>
                            </ul>
                        </div>

                        <div class="security-layer">
                            <h4>Key Storage Hierarchy</h4>
                            <ul>
                                <li>Master keys (HSM-protected)</li>
                                <li>FHE context keys (encrypted)</li>
                                <li>Evaluation keys (versioned)</li>
                                <li>Region-specific isolation</li>
                            </ul>
                        </div>
                    </div>

                    <div class="data-flow">
                        <h4>üîê Key Lifecycle</h4>
                        <div class="flow-diagram">
                            <div class="flow-step">
                                <div class="step-number">1</div>
                                <strong>Generation</strong>
                                <p>HSM creates keys</p>
                            </div>
                            <div class="arrow-right"></div>
                            <div class="flow-step">
                                <div class="step-number">2</div>
                                <strong>Distribution</strong>
                                <p>Secure mTLS delivery</p>
                            </div>
                            <div class="arrow-right"></div>
                            <div class="flow-step">
                                <div class="step-number">3</div>
                                <strong>Rotation</strong>
                                <p>Policy-based renewal</p>
                            </div>
                            <div class="arrow-right"></div>
                            <div class="flow-step">
                                <div class="step-number">4</div>
                                <strong>Archival</strong>
                                <p>Long-term storage</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <h3>üìã Key Types & Usage</h3>
            <table>
                <tr>
                    <th>Key Type</th>
                    <th>Purpose</th>
                    <th>Location</th>
                    <th>Protection</th>
                </tr>
                <tr>
                    <td><strong>Private Key (sk)</strong></td>
                    <td>Decryption only</td>
                    <td>Client (in-memory)</td>
                    <td>Never transmitted</td>
                </tr>
                <tr>
                    <td><strong>Public Key (pk)</strong></td>
                    <td>Encryption</td>
                    <td>Client + Server</td>
                    <td>Can be shared</td>
                </tr>
                <tr>
                    <td><strong>Relinearization Keys</strong></td>
                    <td>Reduce ciphertext size</td>
                    <td>Client + Server</td>
                    <td>Evaluation key</td>
                </tr>
                <tr>
                    <td><strong>Galois Keys</strong></td>
                    <td>Rotation operations</td>
                    <td>Client + Server</td>
                    <td>Evaluation key</td>
                </tr>
                <tr>
                    <td><strong>Bootstrap Keys</strong></td>
                    <td>Refresh ciphertexts (OpenFHE)</td>
                    <td>Client + Server</td>
                    <td>Evaluation key</td>
                </tr>
            </table>
        </div>

        <!-- Slide 5: GCP Data Pipeline -->
        <div class="slide">
            <h2>‚òÅÔ∏è GCP Cloud Data Pipeline (7-Day Hot Storage)</h2>

            <div class="stats-grid">
                <div class="stat-card" style="background: linear-gradient(135deg, #4285f4 0%, #0d47a1 100%);">
                    <div class="number">100-500</div>
                    <div class="label">Dataproc Workers</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #34a853 0%, #1b5e20 100%);">
                    <div class="number">1M/hour</div>
                    <div class="label">Encryption Rate</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #fbbc04 0%, #f57c00 100%);">
                    <div class="number">10K</div>
                    <div class="label">Batch Size</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #ea4335 0%, #c62828 100%);">
                    <div class="number">< 1 sec</div>
                    <div class="label">Query Time (Hot)</div>
                </div>
            </div>

            <div class="architecture-diagram">
                <div class="component-box cloud-zone">
                    <div class="zone-label">GCP DATA PIPELINE</div>
                    
                    <h3>üì• Ingestion Layer</h3>
                    <div class="tech-stack">
                        <div class="tech-badge">Cloud Pub/Sub</div>
                        <div class="tech-badge">Cloud Storage</div>
                        <div class="tech-badge">BigQuery</div>
                    </div>
                    <p><strong>Millions of daily transactions</strong> from various sources</p>

                    <div class="flow-arrow">‚¨áÔ∏è Raw Transactions ‚¨áÔ∏è</div>

                    <h3>üîß Preprocessing Layer (Apache Spark)</h3>
                    <div class="key-points">
                        <ul>
                            <li>Data validation & quality checks</li>
                            <li>PII detection and masking</li>
                            <li>Regional segregation (China, Saudi, EU, US)</li>
                            <li>Feature engineering for ML</li>
                        </ul>
                    </div>

                    <div class="flow-arrow">‚¨áÔ∏è Validated & Segmented ‚¨áÔ∏è</div>

                    <h3>üîê Encryption Layer (Dataproc + TenSEAL/OpenFHE)</h3>
                    <div class="code-snippet">
<span class="comment"># Spark UDF for distributed encryption</span>
<span class="keyword">def</span> encrypt_column(column_data):
    <span class="comment"># Load public key from KMS</span>
    pk = get_public_key_from_kms()
    
    <span class="comment"># Encrypt using TenSEAL</span>
    encrypted = tenseal.encrypt(column_data, pk)
    
    <span class="keyword">return</span> encrypted

<span class="comment"># Process millions in parallel</span>
df.withColumn(<span class="string">"encrypted_amount"</span>, 
              encrypt_column(col(<span class="string">"amount"</span>)))
                    </div>

                    <div class="flow-arrow">‚¨áÔ∏è Encrypted Data ‚¨áÔ∏è</div>

                    <h3>üíæ Storage Layer (7-Day Window)</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="data-flow">
                            <h4>BigQuery</h4>
                            <ul>
                                <li>Partitioned by date & region</li>
                                <li>Clustered by party_id</li>
                                <li>Encrypted columns as BYTES</li>
                                <li>Fast indexed queries</li>
                            </ul>
                        </div>
                        <div class="data-flow">
                            <h4>Cloud Storage</h4>
                            <ul>
                                <li>Parquet format (compressed)</li>
                                <li>Partitioned folder structure</li>
                                <li>Lifecycle: Auto-delete Day 7</li>
                                <li>Parallel retrieval</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="warning-box">
                <strong>Data Residency Compliance:</strong> After 7 days, all data automatically migrated to regional data lakes (SAN/EAP) per compliance requirements
            </div>
        </div>

        <!-- Slide 6: Regional Data Residency -->
        <div class="slide">
            <h2>üåç Regional Data Lakes & Data Residency</h2>

            <div class="architecture-diagram">
                <div class="component-box storage-zone">
                    <div class="zone-label">REGIONAL DATA LAKES (Long-term)</div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                        <div class="security-layer" style="border-color: #dc3545;">
                            <h4>üá®üá≥ China Region (SAN)</h4>
                            <div class="compliance-badge">PIPL Compliant</div>
                            <ul>
                                <li><strong>Storage:</strong> Huawei OBS / Alibaba OSS</li>
                                <li><strong>Retention:</strong> 90 days - 7 years</li>
                                <li><strong>Encryption:</strong> FHE + at-rest</li>
                                <li><strong>Access:</strong> Mainland China only</li>
                            </ul>
                        </div>

                        <div class="security-layer" style="border-color: #28a745;">
                            <h4>üá∏üá¶ Saudi Arabia (EAP)</h4>
                            <div class="compliance-badge">SDAIA Compliant</div>
                            <ul>
                                <li><strong>Storage:</strong> Local DC / AWS ME</li>
                                <li><strong>Retention:</strong> Per SAMA regulations</li>
                                <li><strong>Encryption:</strong> FHE + at-rest</li>
                                <li><strong>Access:</strong> Middle East only</li>
                            </ul>
                        </div>

                        <div class="security-layer" style="border-color: #007bff;">
                            <h4>üá™üá∫ EU Region</h4>
                            <div class="compliance-badge">GDPR Compliant</div>
                            <ul>
                                <li><strong>Storage:</strong> AWS eu-central-1</li>
                                <li><strong>Retention:</strong> 6 years (financial)</li>
                                <li><strong>Encryption:</strong> FHE + GDPR-compliant</li>
                                